# Модуль `src.ai.openai.model`

## Обзор

Модуль содержит класс `OpenAIModel`, который используется для взаимодействия с API OpenAI и обучения модели. Класс предоставляет функции для отправки запросов к модели, получения ответов, анализа тональности, обучения модели, сохранения идентификаторов задач обучения и описания изображений.

## Подробности

Этот модуль используется для взаимодействия с API OpenAI, чтобы использовать модели GPT-4 и другие возможности OpenAI. 
Он обеспечивает:

1. **Инициализация модели:** Создание объекта `OpenAIModel` с ключом API, инструкциями для системы и идентификатором помощника.
2. **Список моделей и помощников:** Получение списка доступных моделей и помощников из API OpenAI.
3. **Запрос к модели:** Отправка сообщения к модели и получение ответа, а также анализ тональности ответа.
4. **Обучение модели:** Обучение модели на основе заданных данных.
5. **Сохранение идентификаторов задач:** Сохранение идентификаторов задач обучения с описанием.
6. **Описание изображения:** Получение описания изображения с помощью API OpenAI.

## Классы

### `OpenAIModel`

**Описание:** Класс `OpenAIModel` обеспечивает взаимодействие с API OpenAI для использования моделей GPT-4 и других возможностей OpenAI.

**Наследует:** 
    - `object`

**Атрибуты:**

    - `model: str`: Имя модели OpenAI (например, `gpt-4o-mini`).
    - `client: OpenAI`: Клиент API OpenAI.
    - `current_job_id: str`: Идентификатор текущей задачи обучения.
    - `assistant_id: str`: Идентификатор помощника OpenAI.
    - `assistant`: Объект помощника OpenAI.
    - `thread`: Объект потока OpenAI.
    - `system_instruction: str`: Инструкция для системы (необязательно).
    - `dialogue_log_path: str | Path`: Путь к файлу для сохранения журнала диалога.
    - `dialogue: List[Dict[str, str]]`: Журнал диалога с моделью.
    - `assistants: List[SimpleNamespace]`: Список доступных помощников.
    - `models_list: List[str]`: Список доступных моделей.

**Методы:**

### `__init__`

**Цель:** Инициализация объекта `OpenAIModel` с ключом API, инструкциями для системы и идентификатором помощника.

**Параметры:**

    - `api_key: str`: Ключ API OpenAI.
    - `system_instruction: str`: Инструкция для системы (необязательно).
    - `model_name: str`: Имя модели OpenAI.
    - `assistant_id: str`: Идентификатор помощника OpenAI.

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время инициализации.

**Пример:**

```python
model = OpenAIModel(api_key="ваш_api_ключ", system_instruction="Вы - дружелюбный помощник.", assistant_id="asst_dr5AgQnhhhnef5OSMzQ9zdk9")
```

### `list_models`

**Цель:** Получение списка доступных моделей из API OpenAI.

**Параметры:**
    - `None`

**Возвращает:**
    - `List[str]`: Список идентификаторов доступных моделей.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время получения списка моделей.

**Пример:**

```python
models = model.list_models
print(models)
```

### `list_assistants`

**Цель:** Получение списка доступных помощников из файла `assistants.json`.

**Параметры:**
    - `None`

**Возвращает:**
    - `List[str]`: Список имен доступных помощников.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время загрузки списка помощников.

**Пример:**

```python
assistants = model.list_assistants
print(assistants)
```

### `set_assistant`

**Цель:** Установка помощника с помощью указанного идентификатора.

**Параметры:**

    - `assistant_id: str`: Идентификатор помощника.

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время установки помощника.

**Пример:**

```python
model.set_assistant(assistant_id="ваш_идентификатор_помощника")
```

### `_save_dialogue`

**Цель:** Сохранение всего диалога в файл JSON.

**Параметры:**
    - `None`

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время сохранения диалога.

**Пример:**

```python
# Этот метод вызывается автоматически в других методах, например, ask().
```

### `determine_sentiment`

**Цель:** Определение тональности сообщения (положительный, отрицательный или нейтральный).

**Параметры:**

    - `message: str`: Сообщение для анализа.

**Возвращает:**
    - `str`: Тональность ("positive", "negative" или "neutral").

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время анализа тональности.

**Пример:**

```python
sentiment = model.determine_sentiment("Это отличный товар!")
print(sentiment) # Вывод: positive
```

### `ask`

**Цель:** Отправка сообщения к модели и получение ответа, а также анализ тональности ответа.

**Параметры:**

    - `message: str`: Сообщение для отправки модели.
    - `system_instruction: str`: Инструкция для системы (необязательно).
    - `attempts: int`: Количество попыток повторной отправки (необязательно, по умолчанию 3).

**Возвращает:**
    - `str`: Ответ от модели.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время отправки сообщения.

**Пример:**

```python
response = model.ask("Как дела?")
print(response)
```

### `describe_image`

**Цель:** Получение описания изображения с помощью API OpenAI.

**Параметры:**

    - `image_path: str | Path`: Путь к изображению.
    - `prompt: Optional[str]`: Дополнительный запрос для модели.
    - `system_instruction: Optional[str]`: Инструкция для системы (необязательно).

**Возвращает:**
    - `str`: Описание изображения.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время отправки изображения.

**Пример:**

```python
description = model.describe_image("путь_к_изображению.jpg")
print(description)
```

### `describe_image_by_requests`

**Цель:** Получение описания изображения с помощью API OpenAI (использование `requests`).

**Параметры:**

    - `image_path: str | Path`: Путь к изображению.
    - `prompt: str`: Дополнительный запрос для модели.

**Возвращает:**
    - `str`: Описание изображения.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время отправки изображения.

**Пример:**

```python
description = model.describe_image_by_requests("путь_к_изображению.jpg")
print(description)
```

### `dynamic_train`

**Цель:** Динамическое обучение модели на основе предыдущего диалога.

**Параметры:**
    - `None`

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время обучения.

**Пример:**

```python
model.dynamic_train()
```

### `train`

**Цель:** Обучение модели на заданных данных.

**Параметры:**

    - `data: str`: Путь к CSV-файлу или CSV-форматированная строка с данными (необязательно).
    - `data_dir: Path | str`: Каталог, содержащий CSV-файлы для обучения (необязательно).
    - `data_file: Path | str`: Путь к одному CSV-файлу с обучающими данными (необязательно).
    - `positive: bool`: Флаг, указывающий, являются ли данные положительными или отрицательными (необязательно, по умолчанию True).

**Возвращает:**
    - `str | None`: Идентификатор задачи обучения или None в случае ошибки.

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время обучения.

**Пример:**

```python
job_id = model.train(data_file="путь_к_файлу.csv")
print(job_id)
```

### `save_job_id`

**Цель:** Сохранение идентификатора задачи обучения с описанием в файл.

**Параметры:**

    - `job_id: str`: Идентификатор задачи.
    - `description: str`: Описание задачи.
    - `filename: str`: Имя файла для сохранения (необязательно, по умолчанию "job_ids.json").

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время сохранения.

**Пример:**

```python
model.save_job_id(job_id="ваш_идентификатор_задачи", description="Обучение модели на новых данных")
```

## Функции

### `main`

**Цель:** Главная функция для инициализации `OpenAIModel` и демонстрации использования.

**Параметры:**
    - `None`

**Возвращает:**
    - `None`

**Поднимает исключения:**
    - `Exception`: Если возникла ошибка во время выполнения.

**Пример:**

```python
# Этот метод вызывается автоматически, если файл выполняется как сценарий.
# Он содержит примеры использования класса OpenAIModel.
```

## Пример использования

```python
# Инициализация модели
model = OpenAIModel(api_key="ваш_api_ключ", system_instruction="Вы - дружелюбный помощник.", assistant_id="asst_dr5AgQnhhhnef5OSMzQ9zdk9")

# Список доступных моделей
print("Доступные модели:")
models = model.list_models
pprint(models)

# Список доступных помощников
print("\nДоступные помощники:")
assistants = model.list_assistants
pprint(assistants)

# Отправка сообщения к модели
user_input = "Как дела?"
print("\nВвод пользователя:", user_input)
response = model.ask(user_input)
print("Ответ модели:", response)

# Динамическое обучение на основе предыдущего диалога
print("\nВыполнение динамического обучения...")
model.dynamic_train()

# Обучение модели на основе предоставленных данных
print("\nОбучение модели...")
training_result = model.train(data_file="путь_к_файлу.csv")
print(f"Идентификатор задачи обучения: {training_result}")

# Сохранение идентификатора задачи
if training_result:
    model.save_job_id(training_result, "Обучение модели на новых данных", filename="job_ids.json")
    print(f"Сохранен идентификатор задачи обучения: {training_result}")

# Описание изображения
image_path = "путь_к_изображению.jpg"
print("\nОписание изображения:")
description = model.describe_image(image_path)
print(f"Описание изображения: {description}")
```
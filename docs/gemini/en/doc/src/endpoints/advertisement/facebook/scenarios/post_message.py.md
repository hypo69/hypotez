# Модуль для публикации сообщений в Facebook

## Обзор

Модуль `src.endpoints.advertisement.facebook.scenarios.post_message` предоставляет функции для публикации сообщений в Facebook, включая загрузку медиафайлов, обновление описаний и публикацию. 

## Детали

Этот модуль предназначен для взаимодействия с Facebook API через WebDriver. Он использует набор локаторов, определенных в файле `post_message.json`, чтобы взаимодействовать с элементами на странице Facebook.

## Функции

### `post_title`

**Описание**: Отправляет заголовок и описание кампании в поле сообщения.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `message` (SimpleNamespace | str): Объект, содержащий заголовок и описание, либо строка с сообщением.

**Возвращает**:
- `bool`: `True`, если заголовок и описание были отправлены успешно, иначе `None`.

**Примеры**:
```python
>>> driver = Driver(...)
>>> category = SimpleNamespace(title="Campaign Title", description="Campaign Description")
>>> post_title(driver, category)
True
```

**Как работает**:
- Сначала функция прокручивает страницу вверх для доступа к полю сообщения.
- Затем она открывает поле "Добавить сообщение".
- После этого она вставляет заголовок и описание в поле сообщения.

### `upload_media`

**Описание**: Загружает медиафайлы в раздел "Изображения" и обновляет подписи.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `media` (SimpleNamespace | List[SimpleNamespace] | str | list[str]): Список товаров, содержащих пути к медиафайлам, или одиночный путь к медиафайлу.
- `no_video` (bool, optional): Если `True`, не загружать видеофайлы. По умолчанию `False`.
- `without_captions` (bool, optional): Если `True`, не обновлять подписи к изображениям. По умолчанию `False`.

**Возвращает**:
- `bool`: `True`, если медиафайлы были успешно загружены, иначе `None`.

**Исключения**:
- `Exception`: Если возникла ошибка во время загрузки медиафайлов или обновления подписей.

**Примеры**:
```python
>>> driver = Driver(...)
>>> products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]
>>> upload_media(driver, products)
True
```

**Как работает**:
- Функция открывает форму "Добавить фото или видео".
- Она итерирует по списку товаров и загружает каждый медиафайл.
- Затем она обновляет подписи к изображениям, используя данные из товаров.

### `update_images_captions`

**Описание**: Добавляет описания к загруженным медиафайлам.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `media` (List[SimpleNamespace]): Список товаров с деталями для обновления.
- `textarea_list` (List[WebElement]): Список текстовых областей, куда добавляются подписи.

**Исключения**:
- `Exception`: Если возникла ошибка при обновлении подписей к медиафайлам.

**Как работает**:
- Функция использует данные из `translations.json` для создания описания для каждого товара.
- Она отправляет сообщение с описанием в соответствующую текстовую область.

### `publish`

**Описание**: Опубликовывает сообщение.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `attempts` (int, optional): Количество попыток публикации. По умолчанию `5`.

**Возвращает**:
- `bool`: `True`, если публикация прошла успешно, иначе `None`.

**Как работает**:
- Функция завершает редактирование сообщения и публикует его.
- Она обрабатывает различные ошибки, которые могут возникнуть во время публикации, такие как диалоговые окна или ошибки сети.

### `promote_post`

**Описание**: Управляет процессом продвижения сообщения с заголовком, описанием и медиафайлами.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `category` (SimpleNamespace): Детали категории, используемые для заголовка и описания сообщения.
- `products` (List[SimpleNamespace]): Список товаров, содержащих медиафайлы и детали, которые нужно опубликовать.

**Примеры**:
```python
>>> driver = Driver(...)
>>> category = SimpleNamespace(title="Campaign Title", description="Campaign Description")
>>> products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]
>>> promote_post(driver, category, products)
```

**Как работает**:
- Функция последовательно вызывает `post_title`, `upload_media` и `publish` для продвижения сообщения.

### `post_message`

**Описание**: Управляет процессом публикации сообщения с заголовком, описанием, медиафайлами и возможностью добавить изображения отдельно от товаров.

**Параметры**:
- `d` (Driver): Экземпляр драйвера, используемого для взаимодействия с веб-страницей.
- `message` (SimpleNamespace): Детали сообщения, используемые для заголовка и описания сообщения.
- `no_video` (bool, optional): Если `True`, не загружать видеофайлы. По умолчанию `False`.
- `images` (Optional[str | list[str]]): Список с путями к изображениям, которые нужно добавить к сообщению отдельно от товаров. 
- `without_captions` (bool, optional): Если `True`, не обновлять подписи к изображениям. По умолчанию `False`.

**Примеры**:
```python
>>> driver = Driver(...)
>>> message = SimpleNamespace(title="Campaign Title", description="Campaign Description", products=[SimpleNamespace(local_image_path='path/to/image.jpg', ...)])
>>> post_message(driver, message)
```

**Как работает**:
- Функция последовательно вызывает `post_title`, `upload_media` и `publish` для публикации сообщения. 
- Если переданы изображения, она добавляет их к сообщению отдельно от товаров. 
- После публикации, она проверяет наличие кнопки "Отправить" и, если она есть, отправляет сообщение. 

## Параметры

### Локаторы

- `locator.open_add_post_box`: Локатор для открытия поля "Добавить сообщение".
- `locator.add_message`: Локатор для вставки текста сообщения.
- `locator.open_add_foto_video_form`: Локатор для открытия формы "Добавить фото или видео".
- `locator.foto_video_input`: Локатор для загрузки медиафайла.
- `locator.edit_uloaded_media_button`: Локатор для перехода к редактированию подписей.
- `locator.uploaded_media_frame`: Локатор для поиска фрейма с загруженным медиафайлом.
- `locator.edit_image_properties_textarea`: Локатор для поиска текстовой области для редактирования подписей.
- `locator.finish_editing_button`: Локатор для завершения редактирования сообщения.
- `locator.publish`: Локатор для публикации сообщения.
- `locator.close_pop_up`: Локатор для закрытия всплывающего окна.
- `locator.not_now`: Локатор для отклонения запроса на публикацию.
- `locator.send`: Локатор для отправки сообщения.

### Переменные

- `local_units`: Словарь с переводами на различные языки. 

## Примеры

```python
from src import gs
from src.webdriver.driver import Driver
from src.endpoints.advertisement.facebook.scenarios.post_message import post_message

# Создайте экземпляр драйвера (например, для Chrome)
driver = Driver(Chrome)

# Подготовка данных для сообщения
message = SimpleNamespace(
    title="Заголовок сообщения",
    description="Описание сообщения",
    products=[
        SimpleNamespace(
            local_image_path="path/to/image.jpg",
            product_title="Название товара",
            description="Описание товара",
            original_price="100",
            sale_price="50",
            discount="50%",
            evaluate_rate="4.5",
            promotion_link="https://example.com",
            language="ru",
        )
    ],
)

# Опубликуйте сообщение
result = post_message(driver, message)

# Вывод результата
if result:
    print("Сообщение опубликовано успешно!")
else:
    print("Ошибка при публикации сообщения.")
```
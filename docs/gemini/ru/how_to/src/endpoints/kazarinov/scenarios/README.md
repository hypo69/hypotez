### Как использовать этот блок кода

=========================================================================================

Описание
-------------------------
Данный блок кода представляет собой диаграмму Mermaid, описывающую процесс обработки запроса на получение обработки продуктов `products_list` с использованием модели (например, Gemini). Диаграмма визуализирует логику обработки запроса, проверки данных и возврата результатов на двух языках (русском и иврите).

Шаги выполнения
-------------------------

1.  **Получение запроса на обработку продуктов:**
    *   Начало процесса с запроса на обработку списка продуктов (`products_list`).

2.  **Обработка запроса с командой модели:**
    *   Запрос передается на обработку с использованием команды модели (например, Gemini).

3.  **Получение ответа от модели:**
    *   Модель возвращает ответ.

4.  **Проверка на отсутствие ответа:**
    *   Если ответ от модели отсутствует:
        *   Логируется ошибка "no response from gemini".
        *   Выполняется повторный запрос (количество попыток уменьшается на 1).

5.  **Проверка на валидность данных:**
    *   Если данные не валидны:
        *   Логируется ошибка "Error in data from gemini".
        *   Выполняется повторный запрос.

6.  **Проверка на полученные данные:**
    *   Если данные получены:
        *   Проверяется, представлены ли данные в виде списка.
            *   Если данные в виде списка:
                *   Проверяется, содержит ли список два элемента (ru, he).
                    *   Если да, извлекаются данные для русского (ru) и иврита (he).
                    *   Если нет, извлекаются данные для русского (ru) и иврита (he) из первого элемента списка.
                    *   Если структура списка невалидна, логируется ошибка "Проблема парсинга ответа", выполняется повторный запрос.
            *   Если данные не в виде списка:
                *   Проверяется, представлены ли данные в виде объекта.
                    *   Если да, извлекаются данные для русского (ru) и иврита (he) из объекта.
                    *   Если нет, логируется ошибка "Invalid ru or he data", выполняется повторный запрос.

7.  **Возврат результата:**
    *   Возвращаются извлеченные данные для русского (ru) и иврита (he).

Пример использования
-------------------------

```python
# Пример использования кода для обработки ответа от модели
def process_model_response(response: dict | list) -> tuple[str, str] | None:
    """
    Функция обрабатывает ответ от модели и извлекает данные для русского и иврита.

    Args:
        response (dict | list): Ответ от модели.

    Returns:
        tuple[str, str] | None: Кортеж с данными для русского и иврита, или None в случае ошибки.
    """
    if not response:
        logger.error("No response from gemini")
        return None

    if isinstance(response, list):
        if len(response) == 2:
            ru, he = response
        else:
            try:
                ru, he = response[0]['ru'], response[0]['he']
            except (KeyError, TypeError):
                logger.error("Проблема парсинга ответа")
                return None
    elif isinstance(response, dict):
        try:
            ru, he = response['ru'], response['he']
        except KeyError:
            logger.error("Invalid ru or he data")
            return None
    else:
        logger.error("Error in data from gemini")
        return None

    return ru, he
```
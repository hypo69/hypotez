## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот сценарий предназначен для автоматизации процесса создания "мехирона" для Сергея Казаринова. Он извлекает, парсит и обрабатывает данные о товарах от различных поставщиков, подготавливает данные, обрабатывает их через ИИ и интегрирует с Facebook для публикации товаров.

Шаги выполнения
-------------------------
1. **Инициализация MexironBuilder**: Создает экземпляр класса `MexironBuilder`, который управляет всем процессом.
2. **Загрузка конфигурации**: Загружает настройки из JSON-файла, определяет путь для экспорта данных и загружает системные инструкции для модели ИИ.
3. **Инициализация модели ИИ**: Подготавливает модель Google Generative AI для обработки данных.
4. **Выполнение сценария**: Выполняет основной сценарий, который включает следующие этапы:
    - **Проверка наличия URLs**: Проверяет, были ли предоставлены URLs для парсинга.
    - **Получение грабера**: Если URLs предоставлены, получает соответствующий грабер для каждого URL поставщика.
    - **Извлечение данных страницы**: Извлекает данные страницы с помощью грабера.
    - **Конвертация полей товара**: Преобразует поля товара в словарь для удобной обработки.
    - **Сохранение данных**: Сохраняет обработанные данные о товаре в файл.
    - **Обработка данных через ИИ**: Обрабатывает данные через модель Google Generative AI для генерации описаний.
    - **Создание отчетов**: Генерирует HTML и PDF отчеты с результатами обработки.
    - **Публикация в Facebook**: Публикует обработанные данные в Facebook.
5. **Завершение**: Сценарий завершает работу.

Пример использования
-------------------------

```python
from src.webdriver.driver import Driver
from src.endpoints.kazarinov.scenarios.scenario_pricelist import MexironBuilder

# Инициализация Driver
driver = Driver(...)  # Инициализируйте Driver здесь, например, driver = Driver(Chrome)

# Инициализация MexironBuilder
mexiron_builder = MexironBuilder(driver)

# Запуск сценария
urls = ['https://example.com/product1', 'https://example.com/product2']
mexiron_builder.run_scenario(urls=urls)
```

### Подробнее о классе `MexironBuilder`:

**Атрибуты**:

- `driver`: Экземпляр Selenium WebDriver для управления веб-браузером.
- `export_path`: Путь для сохранения обработанных данных.
- `mexiron_name`: Пользовательское имя для процесса мехирона.
- `price`: Цена для обработки товаров.
- `timestamp`: Метка времени для процесса.
- `products_list`: Список обработанных данных о товарах.
- `model`: Модель Google Generative AI.
- `config`: Конфигурация, загруженная из JSON-файла.

**Методы**:

- **`__init__(self, driver: Driver, mexiron_name: Optional[str] = None)`**: Инициализирует класс `MexironBuilder` с необходимыми компонентами, включая драйвер и имя мехирона.
- **`run_scenario(self, system_instruction: Optional[str] = None, price: Optional[str] = None, mexiron_name: Optional[str] = None, urls: Optional[str | List[str]] = None, bot = None) -> bool`**: Выполняет основной сценарий, парсит товары, обрабатывает их через ИИ, сохраняет данные и публикует их в Facebook.
- **`get_graber_by_supplier_url(self, url: str)`**: Возвращает соответствующий грабер для данного URL поставщика.
- **`convert_product_fields(self, f: ProductFields) -> dict`**: Преобразует поля товара в словарь.
- **`save_product_data(self, product_data: dict)`**: Сохраняет данные о товаре в файл.
- **`process_llm(self, products_list: List[str], lang: str, attempts: int = 3) -> tuple | bool`**: Обрабатывает список товаров через модель ИИ.
- **`post_facebook(self, mexiron: SimpleNamespace) -> bool`**: Публикует обработанные данные в Facebook.
- **`create_report(self, data: dict, html_file: Path, pdf_file: Path)`**: Генерирует HTML и PDF отчеты из обработанных данных.


### Обработка ошибок

Сценарий включает надежную обработку ошибок, чтобы обеспечить продолжение выполнения даже в случае, если некоторые элементы не найдены или если возникли проблемы с веб-страницей. Это особенно полезно для обработки динамических или нестабильных веб-страниц. 

### Зависимости

- `selenium`: Для веб-автоматизации.
- `asyncio`: Для асинхронных операций.
- `pathlib`: Для обработки путей к файлам.
- `types`: Для создания простых пространств имен.
- `typing`: Для аннотаций типов.
- `src.ai.gemini`: Для обработки данных через ИИ.
- `src.suppliers.*.graber`: Для извлечения данных от различных поставщиков.
- `src.endpoints.advertisement.facebook.scenarios`: Для публикации в Facebook.

### Лицензия

Этот скрипт лицензирован под MIT License. Подробности смотрите в файле `LICENSE`.
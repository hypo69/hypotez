# ะะพะดัะปั ะบะฐัะฐะปะพะณะฐ ัะพะฒะฐัะพะฒ

## ะะฑะทะพั

ะะพะดัะปั `catalog_router.py`  ะฟัะตะดะพััะฐะฒะปัะตั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปั, ัะฒัะทะฐะฝะฝัั ั ะบะฐัะฐะปะพะณะพะผ ัะพะฒะฐัะพะฒ ะฒ Telegram-ะฑะพัะต. ะะฝ ัะพะดะตัะถะธั ะพะฑัะฐะฑะพััะธะบะธ ัะฐะทะปะธัะฝัั ัะธะฟะพะฒ ัะพะฑััะธะน:

- **CallbackQuery**:
    - `page_catalog`: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ะบะฐัะฐะปะพะณะฐ ัะพะฒะฐัะพะฒ.
    - `page_catalog_products`: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ัะพะฒะฐัะพะฒ ะฒ ะฒัะฑัะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ.
    - `process_about`: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะฟะพะบัะฟะบั ัะพะฒะฐัะฐ.
- **PreCheckoutQuery**:
    - `pre_checkout_query`: ะะพะดัะฒะตัะถะดะฐะตั ะฟะปะฐัะตะถ.
- **Message**:
    - `successful_payment`: ะะฑัะฐะฑะฐััะฒะฐะตั ัะพะพะฑัะตะฝะธะต ะพ ััะฟะตัะฝะพะผ ะฟะปะฐัะตะถะต.

## ะะพะดัะพะฑะฝะตะต

ะะพะดัะปั `catalog_router.py`  ะพะฟัะตะดะตะปัะตั ัะพััะตั `catalog_router`, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะทะฐ ะพะฑัะฐะฑะพัะบั ะทะฐะฟัะพัะพะฒ ะพั ะฟะพะปัะทะพะฒะฐัะตะปั, ัะฒัะทะฐะฝะฝัั ั ะบะฐัะฐะปะพะณะพะผ ัะพะฒะฐัะพะฒ. 
ะะฐะถะดัะน ะธะท ะพะฑัะฐะฑะพััะธะบะพะฒ ะทะฐะฟัะพัะพะฒ ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั ัะตัะตะท ัะตััะธั `session_without_commit` ะธะปะธ `session_with_commit` ะดะปั ะฟะพะปััะตะฝะธั ะธ ะพะฑะฝะพะฒะปะตะฝะธั ะธะฝัะพัะผะฐัะธะธ ะพ ัะพะฒะฐัะฐั, ะบะฐัะตะณะพัะธัั ะธ ะฟะปะฐัะตะถะฐั. 

ะะพะดัะปั ะธัะฟะพะปัะทัะตั ััะด ััะฝะบัะธะน ะดะปั ะพะฑัะฐะฑะพัะบะธ ัะฐะทะปะธัะฝัั ัะธะฟะพะฒ ะฟะปะฐัะตะถะตะน, ัะฐะบะธั ะบะฐะบ:

- `send_yukassa_invoice`: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท ะฎKassa.
- `send_robocassa_invoice`: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Robocassa.
- `send_stars_invoice`: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Stars.

## ะะปะฐััั

### `catalog_router`

**ะะฟะธัะฐะฝะธะต**: ะะพััะตั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ, ัะฒัะทะฐะฝะฝัั ั ะบะฐัะฐะปะพะณะพะผ ัะพะฒะฐัะพะฒ.

**ะััะธะฑััั**:

- **`catalog_router`**: ะะพััะตั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ, ัะฒัะทะฐะฝะฝัั ั ะบะฐัะฐะปะพะณะพะผ ัะพะฒะฐัะพะฒ.

**ะะตัะพะดั**:

- **`page_catalog(call: CallbackQuery, session_without_commit: AsyncSession)`**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ะบะฐัะฐะปะพะณะฐ ัะพะฒะฐัะพะฒ.
- **`page_catalog_products(call: CallbackQuery, session_without_commit: AsyncSession)`**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ัะพะฒะฐัะพะฒ ะฒ ะฒัะฑัะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ.
- **`process_about(call: CallbackQuery, session_without_commit: AsyncSession)`**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะฟะพะบัะฟะบั ัะพะฒะฐัะฐ.
- **`send_yukassa_invoice(call, user_info, product_id, price)`**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท ะฎKassa.
- **`send_robocassa_invoice(call, user_info, product_id, price, session: AsyncSession)`**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Robocassa.
- **`send_stars_invoice(call, user_info, product_id, stars_price)`**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Stars.
- **`pre_checkout_query(pre_checkout_q: PreCheckoutQuery)`**: ะะพะดัะฒะตัะถะดะฐะตั ะฟะปะฐัะตะถ.
- **`successful_payment(message: Message, session_with_commit: AsyncSession)`**: ะะฑัะฐะฑะฐััะฒะฐะตั ัะพะพะฑัะตะฝะธะต ะพ ััะฟะตัะฝะพะผ ะฟะปะฐัะตะถะต.

## ะคัะฝะบัะธะธ

### `page_catalog`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ะบะฐัะฐะปะพะณะฐ ัะพะฒะฐัะพะฒ.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `session_without_commit` (`AsyncSession`): ะกะตััะธั ะฑะฐะทั ะดะฐะฝะฝัั ะฑะตะท ะฟะพะดัะฒะตัะถะดะตะฝะธั ะธะทะผะตะฝะตะฝะธะน.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะัะฒะตัะฐะตั ะฝะฐ ะทะฐะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั "ะะฐะณััะทะบะฐ ะบะฐัะฐะปะพะณะฐ...".
- ะฃะดะฐะปัะตั ะฟัะตะดัะดััะตะต ัะพะพะฑัะตะฝะธะต.
- ะะทะฒะปะตะบะฐะตั ะดะฐะฝะฝัะต ะพ ะบะฐัะตะณะพัะธัั ัะพะฒะฐัะพะฒ ะธะท ะฑะฐะทั ะดะฐะฝะฝัั ัะตัะตะท `CategoryDao.find_all`.
- ะัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต ั ัะตะบััะพะผ "ะัะฑะตัะธัะต ะบะฐัะตะณะพัะธั ัะพะฒะฐัะพะฒ:" ะธ ะบะปะฐะฒะธะฐัััะพะน ั ะบะฐัะตะณะพัะธัะผะธ, ะฟะพัััะพะตะฝะฝะพะน ั ะฟะพะผะพััั `catalog_kb`.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await page_catalog(call, session_without_commit)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> ะะฐะณััะทะบะฐ ะบะฐัะฐะปะพะณะฐ...
>>> ะัะฑะตัะธัะต ะบะฐัะตะณะพัะธั ัะพะฒะฐัะพะฒ:
>>> [ะกะฟะธัะพะบ ะบะฐัะตะณะพัะธะน ัะพะฒะฐัะพะฒ] 
```

### `page_catalog_products`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะพัะพะฑัะฐะถะตะฝะธะต ัะพะฒะฐัะพะฒ ะฒ ะฒัะฑัะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `session_without_commit` (`AsyncSession`): ะกะตััะธั ะฑะฐะทั ะดะฐะฝะฝัั ะฑะตะท ะฟะพะดัะฒะตัะถะดะตะฝะธั ะธะทะผะตะฝะตะฝะธะน.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะะทะฒะปะตะบะฐะตั ID ะบะฐัะตะณะพัะธะธ ะธะท ะดะฐะฝะฝัั ะทะฐะฟัะพัะฐ.
- ะะพะปััะฐะตั ัะฟะธัะพะบ ัะพะฒะฐัะพะฒ ะฒ ะฒัะฑัะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ ั ะฟะพะผะพััั `ProductDao.find_all`.
- ะัะพะฒะตััะตั ะบะพะปะธัะตััะฒะพ ัะพะฒะฐัะพะฒ ะฒ ะบะฐัะตะณะพัะธะธ.
- ะัะปะธ ัะพะฒะฐัะพะฒ ะฑะพะปััะต 0, ะฒัะฒะพะดะธั ัะพะพะฑัะตะฝะธะต ั ะบะพะปะธัะตััะฒะพะผ ัะพะฒะฐัะพะฒ ะฒ ะบะฐัะตะณะพัะธะธ ะธ ะพัะพะฑัะฐะถะฐะตั ะบะฐะถะดัะน ัะพะฒะฐั ั ะพะฟะธัะฐะฝะธะตะผ ะธ ะบะฝะพะฟะบะพะน "ะัะฟะธัั".
- ะัะปะธ ัะพะฒะฐัะพะฒ ะฝะตั, ะฒัะฒะพะดะธั ัะพะพะฑัะตะฝะธะต "ะ ะดะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ ะฝะตั ัะพะฒะฐัะพะฒ.".

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await page_catalog_products(call, session_without_commit)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> ะ ะดะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ 5 ัะพะฒะฐัะพะฒ.
>>> ๐ฆ <b>ะะฐะทะฒะฐะฝะธะต ัะพะฒะฐัะฐ:</b> ะขะพะฒะฐั 1
>>> ๐ฐ <b>ะฆะตะฝะฐ:</b> 100 ััะฑ.
>>> ๐ <b>ะะฟะธัะฐะฝะธะต:</b>
>>> <i>ะะฟะธัะฐะฝะธะต ัะพะฒะฐัะฐ 1</i>
>>> โโโโโโโโโโโโโโโโโโ
>>> ๐ฆ <b>ะะฐะทะฒะฐะฝะธะต ัะพะฒะฐัะฐ:</b> ะขะพะฒะฐั 2
>>> ๐ฐ <b>ะฆะตะฝะฐ:</b> 200 ััะฑ.
>>> ๐ <b>ะะฟะธัะฐะฝะธะต:</b>
>>> <i>ะะฟะธัะฐะฝะธะต ัะพะฒะฐัะฐ 2</i>
>>> โโโโโโโโโโโโโโโโโโ
>>> ...
>>> ะ ะดะฐะฝะฝะพะน ะบะฐัะตะณะพัะธะธ ะฝะตั ัะพะฒะฐัะพะฒ.
```

### `process_about`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะฝะฐ ะฟะพะบัะฟะบั ัะพะฒะฐัะฐ.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `session_without_commit` (`AsyncSession`): ะกะตััะธั ะฑะฐะทั ะดะฐะฝะฝัั ะฑะตะท ะฟะพะดัะฒะตัะถะดะตะฝะธั ะธะทะผะตะฝะตะฝะธะน.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะธะท ะฑะฐะทั ะดะฐะฝะฝัั ั ะฟะพะผะพััั `UserDAO.find_one_or_none`.
- ะะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ัะธะฟะต ะฟะปะฐัะตะถะฐ, ID ัะพะฒะฐัะฐ ะธ ัะตะฝะต ะธะท ะดะฐะฝะฝัั ะทะฐะฟัะพัะฐ.
- ะัะทัะฒะฐะตั ัะพะพัะฒะตัััะฒััััั ััะฝะบัะธั ะดะปั ะพัะฟัะฐะฒะบะธ ััะตัะฐ ะฝะฐ ะพะฟะปะฐัั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะธะฟะฐ ะฟะปะฐัะตะถะฐ:
    - `send_yukassa_invoice`: ะดะปั ะฎKassa
    - `send_robocassa_invoice`: ะดะปั Robocassa
    - `send_stars_invoice`: ะดะปั Stars
- ะฃะดะฐะปัะตั ะฟัะตะดัะดััะตะต ัะพะพะฑัะตะฝะธะต.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await process_about(call, session_without_commit)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> ะะพะถะฐะปัะนััะฐ, ะทะฐะฒะตััะธัะต ะพะฟะปะฐัั ะฒ ัะฐะทะผะตัะต 100โฝ, ััะพะฑั ะพัะบัััั ะดะพัััะฟ ะบ ะฒัะฑัะฐะฝะฝะพะผั ัะพะฒะฐัั.
>>> [ะะฝะพะฟะบะฐ "ะะฟะปะฐัะธัั"]
```

### `send_yukassa_invoice`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท ะฎKassa.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `user_info`: ะะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต.
- `product_id`: ID ัะพะฒะฐัะฐ.
- `price`: ะฆะตะฝะฐ ัะพะฒะฐัะฐ.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ั ะฟะพะผะพััั `bot.send_invoice`.
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะทะฐะณะพะปะพะฒะพะบ, ะพะฟะธัะฐะฝะธะต, payload, ัะพะบะตะฝ ะฟัะพะฒะฐะนะดะตัะฐ, ะฒะฐะปััั ะธ ัะตะฝั ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะดะฐะฝะฝัะผะธ ะทะฐะฟัะพัะฐ.
- ะัะฟะพะปัะทัะตั ะบะปะฐะฒะธะฐัััั `get_product_buy_youkassa` ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะพะฟะปะฐัั.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await send_yukassa_invoice(call, user_info, product_id, price)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> [ะกัะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท ะฎKassa]
>>> [ะะฝะพะฟะบะฐ "ะะฟะปะฐัะธัั"]
```

### `send_robocassa_invoice`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Robocassa.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `user_info`: ะะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต.
- `product_id`: ID ัะพะฒะฐัะฐ.
- `price`: ะฆะตะฝะฐ ัะพะฒะฐัะฐ.
- `session` (`AsyncSession`): ะกะตััะธั ะฑะฐะทั ะดะฐะฝะฝัั ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ ะธะทะผะตะฝะตะฝะธะน.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะะพะปััะฐะตั ID ะฟะปะฐัะตะถะฐ ะธะท ะฑะฐะทั ะดะฐะฝะฝัั ั ะฟะพะผะพััั `PurchaseDao.get_next_id`.
- ะคะพัะผะธััะตั ัะตะบัั ัะพะพะฑัะตะฝะธั ะธ ะพะฟะธัะฐะฝะธะต ะฟะปะฐัะตะถะฐ.
- ะะตะฝะตัะธััะตั ัััะปะบั ะฝะฐ ะพะฟะปะฐัั ั ะฟะพะผะพััั `generate_payment_link`.
- ะัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต ั ัััะปะบะพะน ะฝะฐ ะพะฟะปะฐัั ะธ ะบะปะฐะฒะธะฐัััะพะน `get_product_buy_robocassa`.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await send_robocassa_invoice(call, user_info, product_id, price, session)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> ะะพะถะฐะปัะนััะฐ, ะทะฐะฒะตััะธัะต ะพะฟะปะฐัั ะฒ ัะฐะทะผะตัะต 100โฝ, ััะพะฑั ะพัะบัััั ะดะพัััะฟ ะบ ะฒัะฑัะฐะฝะฝะพะผั ัะพะฒะฐัั.
>>> [ะกััะปะบะฐ ะฝะฐ ะพะฟะปะฐัั]
>>> [ะะฝะพะฟะบะฐ "ะะฟะปะฐัะธัั"]
```

### `send_stars_invoice`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Stars.

**ะะฐัะฐะผะตััั**:

- `call` (`CallbackQuery`): ะะฑัะตะบั CallbackQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.
- `user_info`: ะะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต.
- `product_id`: ID ัะพะฒะฐัะฐ.
- `stars_price`: ะฆะตะฝะฐ ัะพะฒะฐัะฐ ะฒ ะทะฒะตะทะดะฐั.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะัะฟัะฐะฒะปัะตั ััะตั ะฝะฐ ะพะฟะปะฐัั ั ะฟะพะผะพััั `bot.send_invoice`.
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะทะฐะณะพะปะพะฒะพะบ, ะพะฟะธัะฐะฝะธะต, payload, ัะพะบะตะฝ ะฟัะพะฒะฐะนะดะตัะฐ, ะฒะฐะปััั ะธ ัะตะฝั ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะดะฐะฝะฝัะผะธ ะทะฐะฟัะพัะฐ.
- ะัะฟะพะปัะทัะตั ะบะปะฐะฒะธะฐัััั `get_product_buy_stars` ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะพะฟะปะฐัั.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await send_stars_invoice(call, user_info, product_id, stars_price)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> [ะกัะตั ะฝะฐ ะพะฟะปะฐัั ัะตัะตะท Stars]
>>> [ะะฝะพะฟะบะฐ "ะะฟะปะฐัะธัั"]
```

### `pre_checkout_query`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะพะดัะฒะตัะถะดะฐะตั ะฟะปะฐัะตะถ.

**ะะฐัะฐะผะตััั**:

- `pre_checkout_q` (`PreCheckoutQuery`): ะะฑัะตะบั PreCheckoutQuery, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะัะฒะตัะฐะตั ะฝะฐ ะทะฐะฟัะพั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะปะฐัะตะถะฐ ั ะฟะพะผะพััั `bot.answer_pre_checkout_query`.
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั `ok=True` ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะปะฐัะตะถะฐ.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await pre_checkout_query(pre_checkout_q)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> ะะปะฐัะตะถ ะฟะพะดัะฒะตัะถะดะตะฝ.
```

### `successful_payment`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑัะฐะฑะฐััะฒะฐะตั ัะพะพะฑัะตะฝะธะต ะพ ััะฟะตัะฝะพะผ ะฟะปะฐัะตะถะต.

**ะะฐัะฐะผะตััั**:

- `message` (`Message`): ะะฑัะตะบั Message, ัะพะดะตัะถะฐัะธะน ะธะฝัะพัะผะฐัะธั ะพ ัะพะพะฑัะตะฝะธะธ.
- `session_with_commit` (`AsyncSession`): ะกะตััะธั ะฑะฐะทั ะดะฐะฝะฝัั ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ ะธะทะผะตะฝะตะฝะธะน.

**ะะพะทะฒัะฐัะฐะตั**:

- `None`

**ะะฐะบ ัะฐะฑะพัะฐะตั ััะฝะบัะธั**:

- ะะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ะฟะปะฐัะตะถะต ะธะท ะดะฐะฝะฝัั ัะพะพะฑัะตะฝะธั.
- ะัะทัะฒะฐะตั ััะฝะบัะธั `successful_payment_logic` ะดะปั ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั ะฟะปะฐัะตะถะฐ.

**ะัะธะผะตัั**:

```python
# ะัะธะผะตั ะฒัะทะพะฒะฐ ััะฝะบัะธะธ
await successful_payment(message, session_with_commit)

# ะัะธะผะตั ะพัะฒะตัะฐ ะฑะพัะฐ
>>> [ะกะพะพะฑัะตะฝะธะต ะพ ััะฟะตัะฝะพะผ ะฟะปะฐัะตะถะต]
```

## ะะฐัะฐะผะตััั ะบะปะฐััะฐ

- **`telegram_id`**: Telegram ID ะฟะพะปัะทะพะฒะฐัะตะปั.
- **`payment_id`**: ID ะฟะปะฐัะตะถะฐ.
- **`price`**: ะกัะผะผะฐ ะฟะปะฐัะตะถะฐ.
- **`product_id`**: ID ัะพะฒะฐัะฐ.
- **`payment_type`**: ะขะธะฟ ะฟะปะฐัะตะถะฐ (Yukassa, Robocassa ะธะปะธ Stars).
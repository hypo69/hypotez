# Сценарий для Казаринова

## Обзор

Модуль `src/endpoints/kazarinov/scenarios/scenario.py` реализует сценарий для сбора информации о товарах, их обработки с помощью ИИ и создания отчетов. Сценарий предназначен для использования в контексте Казаринова, для которого требуется получить данные о товарах, перевести их описание на разные языки и создать отчеты.

## Подробнее

Этот код работает с веб-страницами, собирая информацию о товарах, используя вебдрайвер (Chrome или Firefox), а также с помощью ИИ-модели (Google Generative AI) для перевода и обработки полученной информации.

## Классы

### `class Scenario(QuotationBuilder)`

**Описание**: Класс `Scenario` наследуется от `QuotationBuilder` и представляет собой исполнителя сценария для Казаринова. Класс отвечает за сбор информации о товарах, обработку данных с помощью ИИ и создание отчетов.

**Наследует**: `QuotationBuilder`

**Атрибуты**:

- `driver (Driver):`  Инстанс вебдрайвера, используемого для сбора информации о товарах.
- `mexiron_name (Optional[str]):`  Название мексирона.

**Методы**:

- `__init__(self, mexiron_name:Optional[str] = gs.now, driver:Optional[Firefox | Playwrid | str] = None, **kwargs):`
    - **Описание**: Инициализирует экземпляр класса `Scenario`. 
    - **Параметры**:
        - `mexiron_name (Optional[str], optional):` Название мексирона. По умолчанию `gs.now`.
        - `driver (Optional[Firefox | Playwrid | str], optional):` Инстанс вебдрайвера. По умолчанию `None`.
        - `kwargs`: Дополнительные параметры.
    - **Как работает**:
        - Инициализирует вебдрайвер, если он не был передан в качестве параметра.
        - Вызывает конструктор родительского класса `QuotationBuilder`.
        
- `async def run_scenario_async(self, urls: List[str], price: Optional[str] = '', mexiron_name: Optional[str] = gs.now, bot: Optional[telebot.TeleBot] = None, chat_id: Optional[int] = 0, attempts: int = 3) -> bool:`
    - **Описание**: Запускает сценарий: собирает товары, обрабатывает их с помощью ИИ, сохраняет данные и генерирует отчеты.
    - **Параметры**:
        - `urls (List[str]):` Список URL-адресов товаров.
        - `price (Optional[str], optional):` Цена. По умолчанию ''.
        - `mexiron_name (Optional[str], optional):` Название мексирона. По умолчанию `gs.now`.
        - `bot (Optional[telebot.TeleBot], optional):` Инстанс бота Telegram. По умолчанию `None`.
        - `chat_id (Optional[int], optional):` Идентификатор чата в Telegram. По умолчанию `0`.
        - `attempts (int, optional):` Количество попыток. По умолчанию `3`.
    - **Как работает**:
        - Инициализирует список товаров `products_list`.
        - **Сбор товаров**: Итерирует по списку URL-адресов товаров.
            - Для каждого URL-адреса получает грабер, используя `get_graber_by_supplier_url`.
            - Если грабер найден, пытается получить поля товара с помощью `graber.grab_page_async`.
            - Если поля товара успешно получены, преобразует их в нужный формат с помощью `self.convert_product_fields`.
            - Если преобразование прошло успешно, сохраняет данные о товаре с помощью `self.save_product_data` и добавляет его в список `products_list`.
        - **Обработка данных ИИ**: Итерирует по списку языков `langs_list`.
            - Для каждого языка пытается обработать данные о товарах с помощью ИИ-модели с помощью `self.process_llm_async`.
            - Если обработка успешна, сохраняет полученные данные в JSON-файл.
        - **Создание отчетов**: Итерирует по списку языков `langs_list`.
            - Для каждого языка создает отчеты с помощью `ReportGenerator`.
        - **Возвращает**: `True` в случае успешного выполнения сценария.
    - **Внутренние функции**:
        - `self.convert_product_fields(f)`: Преобразует поля товара в нужный формат.
        - `self.save_product_data(product_data)`: Сохраняет данные о товаре.
        - `self.process_llm_async(products_list, lang)`: Обрабатывает данные о товарах с помощью ИИ-модели.

## Функции

### `def run_sample_scenario():`

**Описание**: Запускает тестовый сценарий.

**Как работает**:
- Создает инстанс класса `Scenario`.
- Вызывает метод `run_scenario_async` для выполнения сценария с тестовыми URL-адресами.

## Параметры класса

- `ENDPOINT (str):` Название точки входа.
- `driver (Driver):` Вебдрайвер.
- `mexiron_name (Optional[str]):` Название мексирона.

## Примеры

```python
# Создание инстанса сценария
scenario = Scenario(mexiron_name='test_mexiron')

# Запуск сценария с тестовыми URL-адресами
urls = [
    'https://www.example.com/product1',
    'https://www.example.com/product2',
]
asyncio.run(scenario.run_scenario_async(urls=urls, mexiron_name='test_mexiron'))
```

## Твое поведение при анализе кода:

- В коде ты можешь встретить выражение между `<` `>`. Например: `<инструкция для модели gemini:Загрузка описаний товаров в PrestaShop.>, <далее, если есть>. Это заготовки, куда ты вставляешь релевантное значение
- Всегда смотри системную инструкцию для обработки кода проекта `hypotez`;
- Анализируй расположение файла в проекте. Это поможет понять его назначение и взаимосвязь с другими файлами. Расположение файла ты найдешь в самой превой строке кода, начинающейся с `## \\file /...`;
- Запоминай предоставленный код и анализируй его связь с другими частями проекта;
- В этой инструкции не надо предлагать улучшение кода. Четко следуй пункту 5. **Пример файла** при составлении ответа
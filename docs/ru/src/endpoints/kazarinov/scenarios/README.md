# Схема обработки товаров `products_list`

## Обзор

Данная схема описывает процесс обработки запроса на обработку списка товаров (`products_list`) с использованием модели (предположительно, Gemini). Она включает в себя этапы обработки запроса, валидации данных и извлечения необходимой информации для последующего использования.

## Подробней

Схема начинается с получения запроса на обработку товаров (`products_list`). Затем запрос передается на обработку с использованием команды модели. После обработки модель возвращает ответ, который может быть в различных форматах. Схема включает в себя проверки на отсутствие ответа, валидность данных и структуру полученных данных, а также логирование ошибок в случае их возникновения. В зависимости от формата данных, схема извлекает необходимые данные (`ru` и `he`) и возвращает результат. Если в процессе обработки возникают ошибки, они логируются, и предпринимается попытка повторного запроса.

## Элементы схемы

### A: Запрос на обработку товаров `products_list`

Описание: Начальная точка процесса, представляющая собой запрос на обработку списка товаров.

### B: Обработка запроса с командой модели

Описание: Этап, на котором запрос передается модели для обработки. Модель выполняет необходимые операции для получения информации о товарах.

### C: Ответ от модели

Описание: Результат обработки запроса моделью. Ответ может содержать данные о товарах в различных форматах.

### D: Логирование ошибки `no response from gemini`

Описание: Этап логирования ошибки в случае отсутствия ответа от модели.

### E: Повторный запрос `/attempts - 1/`

Описание: Этап повторного запроса к модели в случае ошибки или невалидных данных. Количество попыток ограничено.

### F: Логирование ошибки `/Error in data from gemini/`

Описание: Этап логирования ошибки в случае получения невалидных данных от модели.

### G: Данные в виде списка?

Описание: Проверка формата данных, полученных от модели. Проверяется, является ли ответ списком.

### H: Содержит два элемента `/ru, he/?`

Описание: Проверка структуры списка. Проверяется, содержит ли список два элемента, предположительно `ru` и `he`.

### I: Извлечение `ru` и `he`

Описание: Этап извлечения данных `ru` и `he` из списка, если он содержит два элемента.

### J: Извлечение `ru` и `he` из первого элемента

Описание: Этап извлечения данных `ru` и `he` из первого элемента списка, если список не содержит два элемента, но имеет валидную структуру.

### K: Логирование ошибки `/Проблема парсинга ответа/`

Описание: Этап логирования ошибки в случае невозможности распарсить ответ от модели.

### L: Данные в виде объекта?

Описание: Проверка формата данных, полученных от модели. Проверяется, является ли ответ объектом.

### M: Извлечение `ru` и `he` из объекта

Описание: Этап извлечения данных `ru` и `he` из объекта, если ответ представлен в виде объекта.

### N: Логирование ошибки `/Invalid ru or he data/`

Описание: Этап логирования ошибки в случае невалидных данных `ru` или `he`.

### O: Возврат результата `ru` и `he`

Описание: Этап возврата результата, содержащего данные `ru` и `he`.
## \file hypotez/src/goog/spreadsheet/_docs/index.html
# -*- coding: utf-8 -*-


""" module: src.goog.spreadsheet._docs """
MODE = 'debug'
<div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><h2>Постановка задачи</h2><br>
    Пусть нам нужно создать программой на языке Python <a href="https://docs.google.com/spreadsheets/d/1kygOW5wSSVqwf26M-OCT72i0FX0olZAz4duT2i6psp4/edit?usp=sharing">вот такую таблицу</a>:<br>
    <br>
    <a href="https://habrahabr.ru/post/305378/"><img src="https://habrastorage.org/r/w1560/files/5c8/3b1/1f8/5c83b11f836a4dac84a584158a40a6c1.png" alt="image" data-src="https://habrastorage.org/files/5c8/3b1/1f8/5c83b11f836a4dac84a584158a40a6c1.png"></a><br>
    <br>
    Особенности этой таблицы:<br>
    <br>
    <ul>
    <li>задана ширина столбцов;</li>
    <li>верхняя ячейка является объединением <b>A1:E1</b>;</li>
    <li>в некоторых ячейках настроены: формат отображения, размер шрифта, жирность, выравнивание текста и цвет фона;</li>
    <li>значения в последнем столбике вычислены формулой (например, в <b>E4</b> написано <b>=D4-C4</b>);</li>
    <li>нарисована граница под ячейками <b>A3:E3</b>;</li>
    <li>присутствует Пикачу (но это останется как домашнее задание для энтузиастов).</li>
    </ul><br>
    Интересно? Тогда добро пожаловать под кат.<br>
    <a name="habracut"></a><br>
    <h2>Решение</h2><br>
    Сразу отметаем неподходящие библиотеки. Например, <a href="https://github.com/burnash/gspread">gspread</a>. Это обёртка над <a href="https://developers.google.com/google-apps/spreadsheets/">Google Sheets API <b>v3</b></a>, в котором <b>нет</b> методов для настройки оформления таблицы. Даже ширину столбца задать не получится.<br>
    <br>
    Будем использовать <a href="https://developers.google.com/sheets/">Google Sheets API <b>v4</b></a>.<br>
    <br>
    <h3><font color="#ff6000">Шаг 1. Создать сервисный аккаунт</font></h3><br>
    <ol>
    <li>Зайти в <a href="https://console.developers.google.com/project">Google Developers Console</a> и создать новый проект (либо использовать какой-то их тех, что уже есть).</li>
    <li>Включить для этого проекта Drive API и Sheets API.</li>
    <li>Создать учётные данные и сохранить закрытый ключ:<br>
    <br>
    <img src="https://habrastorage.org/r/w1560/files/ad7/59a/1b3/ad759a1b37a340b1aff711873b3aab2c.png" data-src="https://habrastorage.org/files/ad7/59a/1b3/ad759a1b37a340b1aff711873b3aab2c.png"></li>
    </ol><br>
    <br>
    <h3><font color="#ff6000">Шаг 2. Установить необходимые библиотеки</font></h3><br>
    А именно, <b>google-api-python-client</b>. <a href="https://developers.google.com/api-client-library/python/start/installation">Установить</a> можно при помощи <b>pip</b>, например:<br>
    <br>
    <pre><code class="bash">pip install <span class="ͼb">--upgrade</span> google-api-python-client<br></code></pre><br>
    Эта библиотека притянет необходимые зависимости (такие, как <b>oauth2client</b> и прочие).<br>
    <br>
    <h3><font color="#ff6000">Шаг 3. Кодить</font></h3><br>
    <h4><font color="#006000">3.1. Service-объект</font></h4><br>
    Импортируем необходимое:<br>
    <br>
    <pre><code class="python"><span class="ͼ4">import</span> <span class="ͼ5">httplib2</span><br><span class="ͼ4">import</span> <span class="ͼ5">apiclient</span>.<span class="ͼ6">discovery</span><br><span class="ͼ4">from</span> <span class="ͼ5">oauth2client</span>.<span class="ͼ6">service_account</span> <span class="ͼ4">import</span> <span class="ͼ5">ServiceAccountCredentials</span><br></code></pre><br>
    Создаём Service-объект, для работы с Google-таблицами:<br>
    <br>
    <pre><code class="python"><br><span class="ͼ5">CREDENTIALS_FILE</span> <span class="ͼ6">=</span> <span class="ͼ7">'test-proj-for-habr-article-1ab131d98a6b.json'</span>  <span class="ͼ8"># имя файла с закрытым ключом</span><br><br><span class="ͼ5">credentials</span> <span class="ͼ6">=</span> <span class="ͼ5">ServiceAccountCredentials</span>.<span class="ͼ6">from_json_keyfile_name</span>(<span class="ͼ5">CREDENTIALS_FILE</span>, [<span class="ͼ7">'https://www.googleapis.com/auth/spreadsheets'</span>,<br>                                                                                  <span class="ͼ7">'https://www.googleapis.com/auth/drive'</span>])<br><span class="ͼ5">httpAuth</span> <span class="ͼ6">=</span> <span class="ͼ5">credentials</span>.<span class="ͼ6">authorize</span>(<span class="ͼ5">httplib2</span>.<span class="ͼ6">Http</span>())<br><span class="ͼ5">service</span> <span class="ͼ6">=</span> <span class="ͼ5">apiclient</span>.<span class="ͼ6">discovery</span>.<span class="ͼ6">build</span>(<span class="ͼ7">'sheets'</span>, <span class="ͼ7">'v4'</span>, <span class="ͼ5">http</span> <span class="ͼ6">=</span> <span class="ͼ5">httpAuth</span>)<br></code></pre><br>
    <h4><font color="#006000">3.2. Термины и id'шники</font></h4><br>
    Теперь на секунду приостановимся и обсудим терминологию.<br>
    <br>
    <ul>
    <li><b>spreadsheet</b> — это Google-документ с таблицами. Ниже буду называть <b>документ</b> (либо английским названием).<br>
    <br>
    У него есть <code><b><font color="#0000FF">spreadsheetId</font></b></code>, имеющий вид <code>1kygOW5wSSVqwf26M-OCT72i0FX0olZAz4duT2i6psp4</code>.</li>
    <li><b>sheet</b> — это <b>лист</b> внутри <b>spreadsheet</b>. Иначе говоря, вкладка с одной из таблиц (их может быть несколько внутри одного документа).<br>
    <br>
    У <b>sheet</b> есть <code><b><font color="#0000FF">sheetId</font></b></code>, являющийся числом. У первого созданного в документе листа id равен <b>0</b>. В документе всегда есть как минимум один лист (удалить его не получится). Все листы имеют разные id и разные названия.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Историческая справка про worksheet</b><div class="spoiler_text">В старом API лист называется <b>worksheet</b>. У него есть <code><b><font color="#0000FF">worksheetId </font></b></code>(или <code><b><font color="#0000FF">wid</font></b></code>), имеющий вид <code>oowy6v0</code>. Для конвертации в число нужно <a href="http://stackoverflow.com/a/26885636/1565832">особое извращение</a>:<br>
    <pre><code class="python"><br><span class="ͼ5">wid2sheetId</span> <span class="ͼ6">=</span> <span class="ͼ4">lambda</span> <span class="ͼ5">wid</span>: <span class="ͼ5">int</span>(<span class="ͼ5">wid</span>[<span class="ͼ9">1</span>:] <span class="ͼ4">if</span> <span class="ͼ5">len</span>(<span class="ͼ5">wid</span>) <span class="ͼ6">&gt;</span> <span class="ͼ9">3</span> <span class="ͼ4">else</span> <span class="ͼ5">wid</span>, <span class="ͼ9">36</span>) <span class="ͼ6">^</span> (<span class="ͼ9">474</span> <span class="ͼ4">if</span> <span class="ͼ5">len</span>(<span class="ͼ5">wid</span>) <span class="ͼ6">&gt;</span> <span class="ͼ9">3</span> <span class="ͼ4">else</span> <span class="ͼ9">31578</span>)<br></code></pre></div></div></li>
    </ul><br>
    Ссылка на конкретный лист формируется следующим образом:<br>
    <code>https://docs.google.com/spreadsheets/d/<b><font color="#0000FF">spreadsheetId</font></b>/edit#gid=<b><font color="#0000FF">sheetId</font></b></code><br>
    Если отбросить <code>#gid=<b><font color="#0000FF">sheetId</font></b></code>, то по ссылке откроется первый лист в документе.<br>
    <br>
    <h4><font color="#006000">3.3. Новый spreadsheet</font></h4><br>
    Вернёмся к коду. Объект <code>service</code>, который мы создали, даёт нам <a href="https://developers.google.com/sheets/reference/rest/">всего 9 функций</a>. Одна из них называется <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/create"><b>spreadsheets.create</b></a>, она создаёт новый <b>spreadsheet</b>. В качестве аргумента нужно передать объект <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets#Spreadsheet">Spreadsheet</a>. Заполнять все его поля не требуется, у большинства есть значения по умолчанию.<br>
    <br>
    <pre><code class="python"><span class="ͼ5">spreadsheet</span> <span class="ͼ6">=</span> <span class="ͼ5">service</span>.<span class="ͼ6">spreadsheets</span>().<span class="ͼ6">create</span>(<span class="ͼ5">body</span> <span class="ͼ6">=</span> {<br>    <span class="ͼ7">'properties'</span>: {<span class="ͼ7">'title'</span>: <span class="ͼ7">'Сие есть название документа'</span>, <span class="ͼ7">'locale'</span>: <span class="ͼ7">'ru_RU'</span>},<br>    <span class="ͼ7">'sheets'</span>: [{<span class="ͼ7">'properties'</span>: {<span class="ͼ7">'sheetType'</span>: <span class="ͼ7">'GRID'</span>,<br>                               <span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                               <span class="ͼ7">'title'</span>: <span class="ͼ7">'Сие есть название листа'</span>,<br>                               <span class="ͼ7">'gridProperties'</span>: {<span class="ͼ7">'rowCount'</span>: <span class="ͼ9">8</span>, <span class="ͼ7">'columnCount'</span>: <span class="ͼ9">5</span>}}}]<br>}).<span class="ͼ6">execute</span>()<br></code></pre><br>
    В ответ получаем снова объект <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets#Spreadsheet">Spreadsheet</a>, только заполненных параметров больше:<br>
    <br>
    <div class="spoiler spoiler_open"><b class="spoiler_title">Смотреть ответ</b><div class="spoiler_text"><pre><code class="python"><br>{<span class="ͼ7">'properties'</span>: {<span class="ͼ7">'autoRecalc'</span>: <span class="ͼ7">'ON_CHANGE'</span>,<br>                <span class="ͼ7">'defaultFormat'</span>: {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'blue'</span>: <span class="ͼ9">1</span>,<br>                                                      <span class="ͼ7">'green'</span>: <span class="ͼ9">1</span>,<br>                                                      <span class="ͼ7">'red'</span>: <span class="ͼ9">1</span>},<br>                                  <span class="ͼ7">'padding'</span>: {<span class="ͼ7">'bottom'</span>: <span class="ͼ9">2</span>,<br>                                              <span class="ͼ7">'left'</span>: <span class="ͼ9">3</span>,<br>                                              <span class="ͼ7">'right'</span>: <span class="ͼ9">3</span>,<br>                                              <span class="ͼ7">'top'</span>: <span class="ͼ9">2</span>},<br>                                  <span class="ͼ7">'textFormat'</span>: {<span class="ͼ7">'bold'</span>: <span class="ͼ4">False</span>,<br>                                                 <span class="ͼ7">'fontFamily'</span>: <span class="ͼ7">'arial,sans,sans-serif'</span>,<br>                                                 <span class="ͼ7">'fontSize'</span>: <span class="ͼ9">10</span>,<br>                                                 <span class="ͼ7">'foregroundColor'</span>: {},<br>                                                 <span class="ͼ7">'italic'</span>: <span class="ͼ4">False</span>,<br>                                                 <span class="ͼ7">'strikethrough'</span>: <span class="ͼ4">False</span>,<br>                                                 <span class="ͼ7">'underline'</span>: <span class="ͼ4">False</span>},<br>                                  <span class="ͼ7">'verticalAlignment'</span>: <span class="ͼ7">'BOTTOM'</span>,<br>                                  <span class="ͼ7">'wrapStrategy'</span>: <span class="ͼ7">'OVERFLOW_CELL'</span>},<br>                <span class="ͼ7">'locale'</span>: <span class="ͼ7">'ru_RU'</span>,<br>                <span class="ͼ7">'timeZone'</span>: <span class="ͼ7">'Etc/GMT'</span>,<br>                <span class="ͼ7">'title'</span>: <span class="ͼ7">'Сие есть название документа'</span>},<br> <span class="ͼ7">'sheets'</span>: [{<span class="ͼ7">'properties'</span>: {<span class="ͼ7">'gridProperties'</span>: {<span class="ͼ7">'columnCount'</span>: <span class="ͼ9">5</span>,<br>                                               <span class="ͼ7">'rowCount'</span>: <span class="ͼ9">8</span>},<br>                            <span class="ͼ7">'index'</span>: <span class="ͼ9">0</span>,<br>                            <span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                            <span class="ͼ7">'sheetType'</span>: <span class="ͼ7">'GRID'</span>,<br>                            <span class="ͼ7">'title'</span>: <span class="ͼ7">'Сие есть название листа'</span>}}],<br> <span class="ͼ7">'spreadsheetId'</span>: <span class="ͼ7">'1Sfl7EQ0Yuyo65INidt4LCrHMzFI9wrmc96qHq6EEqHM'</span>}<br></code></pre></div></div><br>
    Можно было задать многие из них в запросе, но для решения текущей задачи нас устраивают параметры по умолчанию.<br>
    Параметру <code>locale</code> было задано значение <code>ru_RU</code> не случайно, но об этом позже.<br>
    <br>
    В ответе содержится <code>spreadsheetId</code>. Ура! Идём смотреть глазами на <a href="https://docs.google.com/spreadsheets/d/1Sfl7EQ0Yuyo65INidt4LCrHMzFI9wrmc96qHq6EEqHM/edit">созданный документ</a>… и обламываемся, потому что доступа к нему у нас нет. Даже на чтение. Всё как у обычной свежесозданной пользователем вручную Google-таблицы.<br>
    А у кого доступ? У сервисного аккаунта.<br>
    <br>
    <div class="spoiler spoiler_open"><b class="spoiler_title">Жмёте на кнопку «Запросить разрешение на доступ»?</b><div class="spoiler_text">Не заспамьте себя. При нажатии этой кнопки будет отправлено письмо на e-mail наподобие <i>account@test-proj-for-habr-article.iam.gserviceaccount.com</i>. Доставить это письмо не получится (потому что домена не существует), и на Вашу почту придёт сообщение о неудачной доставке письма. Содержимое письма тоже не поможет, потому что ссылка для выдачи доступа может работать только если Вы залогинены под аккаунт владельца, то есть под сервисный аккаунт.<br>
    </div></div><br>
    Что же делать? Ответ очевиден: выдать доступ к документу тоже с помощью API.<br>
    <br>
    <div class="spoiler spoiler_open"><b class="spoiler_title">Ну или другой вариант</b><div class="spoiler_text">Можно создать документ вручную на своём Google-диске и дать доступ сервисному аккаунту (то есть вручную выдать разрешения тому e-mail наподобие <i>account@test-proj-for-habr-article.iam.gserviceaccount.com</i>). Затем работать с этим документом через API.<br>
    <br>
    Меня этот вариант не устроил, потому что мне требовалось научить программу создавать много разных документов.<br>
    </div></div><br>
    <h4><font color="#006000">3.4. Доступ к новому документу</font></h4><br>
    У нашего объекта <code>service</code> нет метода для настройки доступа к документу. Его просто нет в Google Sheets API. Зато <a href="https://developers.google.com/drive/v3/web/manage-sharing">он есть</a> в <a href="https://developers.google.com/drive/v3/web/about-sdk">Google <b>Drive</b> API v3</a>. Пишем код.<br>
    <br>
    <pre><code class="python"><span class="ͼ5">driveService</span> <span class="ͼ6">=</span> <span class="ͼ5">apiclient</span>.<span class="ͼ6">discovery</span>.<span class="ͼ6">build</span>(<span class="ͼ7">'drive'</span>, <span class="ͼ7">'v3'</span>, <span class="ͼ5">http</span> <span class="ͼ6">=</span> <span class="ͼ5">httpAuth</span>)<br><span class="ͼ5">shareRes</span> <span class="ͼ6">=</span> <span class="ͼ5">driveService</span>.<span class="ͼ6">permissions</span>().<span class="ͼ6">create</span>(<br>    <span class="ͼ5">fileId</span> <span class="ͼ6">=</span> <span class="ͼ5">spreadsheet</span>[<span class="ͼ7">'spreadsheetId'</span>],<br>    <span class="ͼ5">body</span> <span class="ͼ6">=</span> {<span class="ͼ7">'type'</span>: <span class="ͼ7">'anyone'</span>, <span class="ͼ7">'role'</span>: <span class="ͼ7">'reader'</span>},  <span class="ͼ8"># доступ на чтение кому угодно</span><br>    <span class="ͼ5">fields</span> <span class="ͼ6">=</span> <span class="ͼ7">'id'</span><br>).<span class="ͼ6">execute</span>()<br></code></pre><br>
    Такой код даёт доступ всем на чтение <a href="https://docs.google.com/spreadsheets/d/1cZydEMbMomTfmPFj6IX_5F0ayiKD8H4DKS3lQt0wChc/edit">по ссылке</a>. Допустим, мы желаем вместо этого дать доступ на редактирование пользователю <i>user@example.com</i>. Для этого вместо <br>
    <br>
    <pre><code class="python">{<span class="ͼ7">'type'</span>: <span class="ͼ7">'anyone'</span>, <span class="ͼ7">'role'</span>: <span class="ͼ7">'reader'</span>}</code></pre> <br>
    пишем <br>
    <br>
    <pre><code class="python">{<span class="ͼ7">'type'</span>: <span class="ͼ7">'user'</span>, <span class="ͼ7">'role'</span>: <span class="ͼ7">'writer'</span>, <span class="ͼ7">'emailAddress'</span>: <span class="ͼ7">'user@example.com'</span>}</code></pre><br>
    <h4><font color="#006000">3.5. Ещё немного теории</font></h4><br>
    Начнём оформление таблицы с выставления ширины столбцов. Ой, а где такая функция? Всё не так прозрачно и чуть более умно, чем просто какой-нибудь <code>setColumnWidth</code>.<br>
    <br>
    Есть функция <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/batchUpdate"><b>spreadsheets.batchUpdate</b></a>. Она применяет сразу пачку изменений к документу. А точнее, сначала она проверяет всю пачку на корректность. Если всё OK, то атомарно применяет всё и возвращает соответствующую пачку результатов. Список изменений, которые можно применять этой функцией, <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request">находится здесь</a>.<br>
    <br>
    <h4><font color="#006000">3.6. Ширина столбцов</font></h4><br>
    Чтобы задать ширину столбцов нужно сделать <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request#UpdateDimensionPropertiesRequest">UpdateDimensionPropertiesRequest</a>.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Читать код</b><div class="spoiler_text"><pre><code class="python"><br><span class="ͼ5">results</span> <span class="ͼ6">=</span> <span class="ͼ5">service</span>.<span class="ͼ6">spreadsheets</span>().<span class="ͼ6">batchUpdate</span>(<span class="ͼ5">spreadsheetId</span> <span class="ͼ6">=</span> <span class="ͼ5">spreadsheet</span>[<span class="ͼ7">'spreadsheetId'</span>], <span class="ͼ5">body</span> <span class="ͼ6">=</span> {<br>  <span class="ͼ7">"requests"</span>: [<br><br>    <span class="ͼ8"># Задать ширину столбца A: 317 пикселей</span><br>    {<br>      <span class="ͼ7">"updateDimensionProperties"</span>: {<br>        <span class="ͼ7">"range"</span>: {<br>          <span class="ͼ7">"sheetId"</span>: <span class="ͼ9">0</span>,<br>          <span class="ͼ7">"dimension"</span>: <span class="ͼ7">"COLUMNS"</span>,  <span class="ͼ8"># COLUMNS - потому что столбец</span><br>          <span class="ͼ7">"startIndex"</span>: <span class="ͼ9">0</span>,         <span class="ͼ8"># Столбцы нумеруются с нуля</span><br>          <span class="ͼ7">"endIndex"</span>: <span class="ͼ9">1</span>            <span class="ͼ8"># startIndex берётся включительно, endIndex - НЕ включительно,</span><br>                                   <span class="ͼ8"># т.е. размер будет применён к столбцам в диапазоне [0,1), т.е. только к столбцу A</span><br>        },<br>        <span class="ͼ7">"properties"</span>: {<br>          <span class="ͼ7">"pixelSize"</span>: <span class="ͼ9">317</span>     <span class="ͼ8"># размер в пикселях</span><br>        },<br>        <span class="ͼ7">"fields"</span>: <span class="ͼ7">"pixelSize"</span>  <span class="ͼ8"># нужно задать только pixelSize и не трогать другие параметры столбца</span><br>      }<br>    },<br><br>    <span class="ͼ8"># Задать ширину столбца B: 200 пикселей</span><br>    {<br>      <span class="ͼ7">"updateDimensionProperties"</span>: {<br>        <span class="ͼ7">"range"</span>: {<br>          <span class="ͼ7">"sheetId"</span>: <span class="ͼ9">0</span>,<br>          <span class="ͼ7">"dimension"</span>: <span class="ͼ7">"COLUMNS"</span>,<br>          <span class="ͼ7">"startIndex"</span>: <span class="ͼ9">1</span>,<br>          <span class="ͼ7">"endIndex"</span>: <span class="ͼ9">2</span><br>        },<br>        <span class="ͼ7">"properties"</span>: {<br>          <span class="ͼ7">"pixelSize"</span>: <span class="ͼ9">200</span><br>        },<br>        <span class="ͼ7">"fields"</span>: <span class="ͼ7">"pixelSize"</span><br>      }<br>    },<br><br>    <span class="ͼ8"># Задать ширину столбцов C и D: 165 пикселей</span><br>    {<br>      <span class="ͼ7">"updateDimensionProperties"</span>: {<br>        <span class="ͼ7">"range"</span>: {<br>          <span class="ͼ7">"sheetId"</span>: <span class="ͼ9">0</span>,<br>          <span class="ͼ7">"dimension"</span>: <span class="ͼ7">"COLUMNS"</span>,<br>          <span class="ͼ7">"startIndex"</span>: <span class="ͼ9">2</span>,<br>          <span class="ͼ7">"endIndex"</span>: <span class="ͼ9">4</span><br>        },<br>        <span class="ͼ7">"properties"</span>: {<br>          <span class="ͼ7">"pixelSize"</span>: <span class="ͼ9">165</span><br>        },<br>        <span class="ͼ7">"fields"</span>: <span class="ͼ7">"pixelSize"</span><br>      }<br>    },<br><br>    <span class="ͼ8"># Задать ширину столбца E: 100 пикселей</span><br>    {<br>      <span class="ͼ7">"updateDimensionProperties"</span>: {<br>        <span class="ͼ7">"range"</span>: {<br>          <span class="ͼ7">"sheetId"</span>: <span class="ͼ9">0</span>,<br>          <span class="ͼ7">"dimension"</span>: <span class="ͼ7">"COLUMNS"</span>,<br>          <span class="ͼ7">"startIndex"</span>: <span class="ͼ9">4</span>,<br>          <span class="ͼ7">"endIndex"</span>: <span class="ͼ9">5</span><br>        },<br>        <span class="ͼ7">"properties"</span>: {<br>          <span class="ͼ7">"pixelSize"</span>: <span class="ͼ9">100</span><br>        },<br>        <span class="ͼ7">"fields"</span>: <span class="ͼ7">"pixelSize"</span><br>      }<br>    }<br>  ]<br>}).<span class="ͼ6">execute</span>()<br></code></pre></div></div><br>
    Получилось весьма громоздко и много копипасты. На этом этапе я решил написать небольшой класс-обёртку над Sheets API, который даст мне в удобном виде необходимые методы.<br>
    <br>
    <h4><font color="#006000">3.7. Логика класса-обёртки</font></h4><br>
    Пусть класс-обёртка (назовём его <b>Spreadsheet</b>) хранит список <b>requests</b> и в своём методе <b>runPrepared</b> передаст его функции <b>spreadsheets.batchUpdate</b>, а затем очистит. Добавлять элементы в этот список будут методы вида <b>prepare_соответствующийЗапрос</b>.<br>
    <br>
    Теперь код для задания ширины столбцов выглядит так:<br>
    <br>
    <pre><code class="python"><br><span class="ͼ8"># ss - экземпляр нашего класса Spreadsheet</span><br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setColumnWidth</span>(<span class="ͼ9">0</span>, <span class="ͼ9">317</span>)<br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setColumnWidth</span>(<span class="ͼ9">1</span>, <span class="ͼ9">200</span>)<br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setColumnsWidth</span>(<span class="ͼ9">2</span>, <span class="ͼ9">3</span>, <span class="ͼ9">165</span>)<br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setColumnWidth</span>(<span class="ͼ9">4</span>, <span class="ͼ9">100</span>)<br><span class="ͼ5">ss</span>.<span class="ͼ6">runPrepared</span>()<br></code></pre><br>
    И вот код методов <b>prepare_setColumnWidth</b> и <b>prepare_setColumnsWidth</b>:<br>
    <br>
    <pre><code class="python"><span class="ͼ4">class</span> <span class="ͼ5">Spreadsheet</span>:<br><br>    <span class="ͼ8"># ...</span><br><br>    <span class="ͼ4">def</span> <span class="ͼ5">prepare_setDimensionPixelSize</span>(<span class="ͼ9">self</span>, <span class="ͼ5">dimension</span>, <span class="ͼ5">startIndex</span>, <span class="ͼ5">endIndex</span>, <span class="ͼ5">pixelSize</span>):<br>        <span class="ͼ9">self</span>.<span class="ͼ6">requests</span>.<span class="ͼ6">append</span>({<span class="ͼ7">"updateDimensionProperties"</span>: {<br>            <span class="ͼ7">"range"</span>: {<span class="ͼ7">"sheetId"</span>: <span class="ͼ9">self</span>.<span class="ͼ6">sheetId</span>,<br>                      <span class="ͼ7">"dimension"</span>: <span class="ͼ5">dimension</span>,<br>                      <span class="ͼ7">"startIndex"</span>: <span class="ͼ5">startIndex</span>,<br>                      <span class="ͼ7">"endIndex"</span>: <span class="ͼ5">endIndex</span>},<br>            <span class="ͼ7">"properties"</span>: {<span class="ͼ7">"pixelSize"</span>: <span class="ͼ5">pixelSize</span>},<br>            <span class="ͼ7">"fields"</span>: <span class="ͼ7">"pixelSize"</span>}})<br><br>    <span class="ͼ4">def</span> <span class="ͼ5">prepare_setColumnsWidth</span>(<span class="ͼ9">self</span>, <span class="ͼ5">startCol</span>, <span class="ͼ5">endCol</span>, <span class="ͼ5">width</span>):<br>        <span class="ͼ9">self</span>.<span class="ͼ6">prepare_setDimensionPixelSize</span>(<span class="ͼ7">"COLUMNS"</span>, <span class="ͼ5">startCol</span>, <span class="ͼ5">endCol</span> <span class="ͼ6">+</span> <span class="ͼ9">1</span>, <span class="ͼ5">width</span>)<br><br>    <span class="ͼ4">def</span> <span class="ͼ5">prepare_setColumnWidth</span>(<span class="ͼ9">self</span>, <span class="ͼ5">col</span>, <span class="ͼ5">width</span>):<br>        <span class="ͼ9">self</span>.<span class="ͼ6">prepare_setColumnsWidth</span>(<span class="ͼ5">col</span>, <span class="ͼ5">col</span>, <span class="ͼ5">width</span>)</code></pre><br>
    Код метода <b>runPrepared</b> я приведу немного далее, потому что он пополнится ещё кое-чем.<br>
    <br>
    <h4><font color="#006000">3.8. Заполнение ячеек данными</font></h4><br>
    Для заполнения ячеек информацией в Google Sheets API v4 предусмотрена функция <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets.values/batchUpdate"><b>spreadsheets.values.batchUpdate</b></a>, работающая по тому же принципу, что и <b>spreadsheets.batchUpdate</b>. Она принимает список прямоугольников и значений, которые нужно записать в каждый из них. Кроме этого, принимает параметр <a href="https://developers.google.com/sheets/reference/rest/v4/ValueInputOption">ValueInputOption</a>:<br>
    <br>
    <ul>
    <li>если <code>USER_ENTERED</code>, то данные интерпретируются, как вводимые пользователем;</li>
    <li>если <code>RAW</code>, то никак не интерпретируются и сохраняются в сыром виде.</li>
    </ul><br>
    Нам нужен первый вариант, потому что требуется, чтобы таблица распознавала даты и формулы.<br>
    <br>
    Вот так можно заполнить данными пару прямоугольников на листе <b>без</b> использования нашего класса-обёртки:<br>
    <br>
    <pre><code class="python"><span class="ͼ5">results</span> <span class="ͼ6">=</span> <span class="ͼ5">service</span>.<span class="ͼ6">spreadsheets</span>().<span class="ͼ6">values</span>().<span class="ͼ6">batchUpdate</span>(<span class="ͼ5">spreadsheetId</span> <span class="ͼ6">=</span> <span class="ͼ5">spreadsheet</span>[<span class="ͼ7">'spreadsheetId'</span>], <span class="ͼ5">body</span> <span class="ͼ6">=</span> {<br>    <span class="ͼ7">"valueInputOption"</span>: <span class="ͼ7">"USER_ENTERED"</span>,<br>    <span class="ͼ7">"data"</span>: [<br>        {<span class="ͼ7">"range"</span>: <span class="ͼ7">"Сие есть название листа!B2:C3"</span>,<br>         <span class="ͼ7">"majorDimension"</span>: <span class="ͼ7">"ROWS"</span>,     <span class="ͼ8"># сначала заполнять ряды, затем столбцы (т.е. самые внутренние списки в values - это ряды)</span><br>         <span class="ͼ7">"values"</span>: [[<span class="ͼ7">"This is B2"</span>, <span class="ͼ7">"This is C2"</span>], [<span class="ͼ7">"This is B3"</span>, <span class="ͼ7">"This is C3"</span>]]},<br><br>        {<span class="ͼ7">"range"</span>: <span class="ͼ7">"Сие есть название листа!D5:E6"</span>,<br>         <span class="ͼ7">"majorDimension"</span>: <span class="ͼ7">"COLUMNS"</span>,  <span class="ͼ8"># сначала заполнять столбцы, затем ряды (т.е. самые внутренние списки в values - это столбцы)</span><br>         <span class="ͼ7">"values"</span>: [[<span class="ͼ7">"This is D5"</span>, <span class="ͼ7">"This is D6"</span>], [<span class="ͼ7">"This is E5"</span>, <span class="ͼ7">"=5+5"</span>]]}<br>    ]<br>}).<span class="ͼ6">execute</span>()<br></code></pre><br>
    Получим <a href="https://docs.google.com/spreadsheets/d/1PPVP_0HIH9sljQjD86pKJaYaPFmMJgONLpUc9Djhoqg/edit#gid=0">вот такой документ</a>.<br>
    <br>
    Теперь сделаем, чтобы наш класс-обёртка предоставил удобные методы для достижения того же результата.<br>
    Пусть функция <b>spreadsheets.values.batchUpdate</b> вызывается в методе <b>runPrepared</b>, а метод <b>prepare_setValues</b> добавляет прямоугольник и данные в список <b>valueRanges</b>, который при вызове <b>runPrepared</b> будет передан в <b>spreadsheets.values.batchUpdate</b>.<br>
    <br>
    Код методов <b>prepare_setValues</b> и <b>runPrepared</b>:<br>
    <br>
    <pre><code class="python"><br><span class="ͼ4">class</span> <span class="ͼ5">Spreadsheet</span>:<br><br>    <span class="ͼ8"># ...</span><br><br>    <span class="ͼ4">def</span> <span class="ͼ5">prepare_setValues</span>(<span class="ͼ9">self</span>, <span class="ͼ5">cellsRange</span>, <span class="ͼ5">values</span>, <span class="ͼ5">majorDimension</span> <span class="ͼ6">=</span> <span class="ͼ7">"ROWS"</span>):<br>        <span class="ͼ9">self</span>.<span class="ͼ6">valueRanges</span>.<span class="ͼ6">append</span>({<span class="ͼ7">"range"</span>: <span class="ͼ9">self</span>.<span class="ͼ6">sheetTitle</span> <span class="ͼ6">+</span> <span class="ͼ7">"!"</span> <span class="ͼ6">+</span> <span class="ͼ5">cellsRange</span>, <span class="ͼ7">"majorDimension"</span>: <span class="ͼ5">majorDimension</span>, <span class="ͼ7">"values"</span>: <span class="ͼ5">values</span>})<br><br>    <span class="ͼ8"># spreadsheets.batchUpdate and spreadsheets.values.batchUpdate</span><br>    <span class="ͼ4">def</span> <span class="ͼ5">runPrepared</span>(<span class="ͼ9">self</span>, <span class="ͼ5">valueInputOption</span> <span class="ͼ6">=</span> <span class="ͼ7">"USER_ENTERED"</span>):<br>        <span class="ͼ5">upd1Res</span> <span class="ͼ6">=</span> {<span class="ͼ7">'replies'</span>: []}<br>        <span class="ͼ5">upd2Res</span> <span class="ͼ6">=</span> {<span class="ͼ7">'responses'</span>: []}<br>        <span class="ͼ4">try</span>:<br>            <span class="ͼ4">if</span> <span class="ͼ5">len</span>(<span class="ͼ9">self</span>.<span class="ͼ6">requests</span>) <span class="ͼ6">&gt;</span> <span class="ͼ9">0</span>:<br>                <span class="ͼ5">upd1Res</span> <span class="ͼ6">=</span> <span class="ͼ9">self</span>.<span class="ͼ6">service</span>.<span class="ͼ6">spreadsheets</span>().<span class="ͼ6">batchUpdate</span>(<span class="ͼ5">spreadsheetId</span> <span class="ͼ6">=</span> <span class="ͼ9">self</span>.<span class="ͼ6">spreadsheetId</span>,<br>                                                                  <span class="ͼ5">body</span> <span class="ͼ6">=</span> {<span class="ͼ7">"requests"</span>: <span class="ͼ9">self</span>.<span class="ͼ6">requests</span>}).<span class="ͼ6">execute</span>()<br>            <span class="ͼ4">if</span> <span class="ͼ5">len</span>(<span class="ͼ9">self</span>.<span class="ͼ6">valueRanges</span>) <span class="ͼ6">&gt;</span> <span class="ͼ9">0</span>:<br>                <span class="ͼ5">upd2Res</span> <span class="ͼ6">=</span> <span class="ͼ9">self</span>.<span class="ͼ6">service</span>.<span class="ͼ6">spreadsheets</span>().<span class="ͼ6">values</span>().<span class="ͼ6">batchUpdate</span>(<span class="ͼ5">spreadsheetId</span> <span class="ͼ6">=</span> <span class="ͼ9">self</span>.<span class="ͼ6">spreadsheetId</span>,<br>                                                                           <span class="ͼ5">body</span> <span class="ͼ6">=</span> {<span class="ͼ7">"valueInputOption"</span>: <span class="ͼ5">valueInputOption</span>,<br>                                                                                   <span class="ͼ7">"data"</span>: <span class="ͼ9">self</span>.<span class="ͼ6">valueRanges</span>}).<span class="ͼ6">execute</span>()<br>        <span class="ͼ4">finally</span>:<br>            <span class="ͼ9">self</span>.<span class="ͼ6">requests</span> <span class="ͼ6">=</span> []<br>            <span class="ͼ9">self</span>.<span class="ͼ6">valueRanges</span> <span class="ͼ6">=</span> []<br>        <span class="ͼ4">return</span> (<span class="ͼ5">upd1Res</span>[<span class="ͼ7">'replies'</span>], <span class="ͼ5">upd2Res</span>[<span class="ͼ7">'responses'</span>])<br></code></pre><br>
    Заполним данными ту же пару прямоугольников, что и в примере выше, но уже <b>с</b> использованием нашего класса-обёртки:<br>
    <br>
    <pre><code class="python"><br><span class="ͼ8"># ss - экземпляр нашего класса Spreadsheet</span><br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setValues</span>(<span class="ͼ7">"B2:C3"</span>, [[<span class="ͼ7">"This is B2"</span>, <span class="ͼ7">"This is C2"</span>], [<span class="ͼ7">"This is B3"</span>, <span class="ͼ7">"This is C3"</span>]])<br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setValues</span>(<span class="ͼ7">"D5:E6"</span>, [[<span class="ͼ7">"This is D5"</span>, <span class="ͼ7">"This is D6"</span>], [<span class="ͼ7">"This is E5"</span>, <span class="ͼ7">"=5+5"</span>]], <span class="ͼ7">"COLUMNS"</span>)<br><span class="ͼ5">ss</span>.<span class="ͼ6">runPrepared</span>()<br></code></pre><br>
    <h4><font color="#006000">3.9. Объединение ячеек, настройка жирности, формата отображения, цвета фона и прочего</font></h4><br>
    Кому не терпится, можете сразу <a href="https://github.com/Tsar/Spreadsheet/blob/master/Spreadsheet.py#L30">читать полный код класса <b>Spreadsheet</b></a> и <a href="https://github.com/Tsar/Spreadsheet/blob/master/Spreadsheet.py#L270">пример его использования</a>, который является решением задачи, поставленной в начале статьи.<br>
    <br>
    Для более терпеливого читателя:<br>
    <br>
    <ul>
    <li><a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request#MergeCellsRequest">MergeCellsRequest</a> — объединить ячейки.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Пример</b><div class="spoiler_text"><pre><code class="python"><br><span class="ͼ8"># Объединить ячейки A1:E1</span><br>{<span class="ͼ7">'mergeCells'</span>: {<span class="ͼ7">'range'</span>: {<span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ9">1</span>,<br>                          <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ9">5</span>},<br>                <span class="ͼ7">'mergeType'</span>: <span class="ͼ7">'MERGE_ALL'</span>}}<br><br><span class="ͼ8"># Подготовить такой запрос при помощи класса Spreadsheet</span><br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_mergeCells</span>(<span class="ͼ7">'A1:E1'</span>)<br></code></pre></div></div></li>
    <li><a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request#RepeatCellRequest">RepeatCellRequest</a> — применить одинаковые изменения ко всем ячейкам в указанном диапазоне.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Примеры</b><div class="spoiler_text"><pre><code class="python"><br><span class="ͼ8"># Сделать жирными и выровнять по центру ячейки A3:E3</span><br>{<span class="ͼ7">'repeatCell'</span>: {<span class="ͼ7">'range'</span>: {<span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ9">2</span>,<br>                          <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ9">3</span>,<br>                          <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ9">5</span>},<br>                <span class="ͼ7">'cell'</span>: {<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'horizontalAlignment'</span>: <span class="ͼ7">'CENTER'</span>,<br>                                               <span class="ͼ7">'textFormat'</span>: {<span class="ͼ7">'bold'</span>: <span class="ͼ4">True</span>}}},<br>                <span class="ͼ7">'fields'</span>: <span class="ͼ7">'userEnteredFormat'</span>}}  <span class="ͼ8"># другие параметры форматирования ячейки будут сброшены</span><br><br><span class="ͼ8"># Формат отображения «продолжительность» для ячеек E4:E8</span><br>{<span class="ͼ7">'repeatCell'</span>: {<span class="ͼ7">'range'</span>: {<span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                          <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ9">3</span>,<br>                          <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ9">8</span>,<br>                          <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ9">4</span>,<br>                          <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ9">5</span>},<br>                <span class="ͼ7">'cell'</span>: {<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'numberFormat'</span>: {<span class="ͼ7">'pattern'</span>: <span class="ͼ7">'[h]:mm:ss'</span>,<br>                                                                <span class="ͼ7">'type'</span>: <span class="ͼ7">'TIME'</span>}}},<br>                <span class="ͼ7">'fields'</span>: <span class="ͼ7">'userEnteredFormat.numberFormat'</span>}}  <span class="ͼ8"># для ячейки изменится только формат отображения</span><br><br><span class="ͼ8"># Подготовить такие запросы при помощи класса Spreadsheet</span><br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setCellsFormat</span>(<span class="ͼ7">'A3:E3'</span>, {<span class="ͼ7">'horizontalAlignment'</span>: <span class="ͼ7">'CENTER'</span>, <span class="ͼ7">'textFormat'</span>: {<span class="ͼ7">'bold'</span>: <span class="ͼ4">True</span>}})<br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setCellsFormat</span>(<span class="ͼ7">'E4:E8'</span>, {<span class="ͼ7">'numberFormat'</span>: {<span class="ͼ7">'pattern'</span>: <span class="ͼ7">'[h]:mm:ss'</span>, <span class="ͼ7">'type'</span>: <span class="ͼ7">'TIME'</span>}},<br>                          <span class="ͼ5">fields</span> <span class="ͼ6">=</span> <span class="ͼ7">'userEnteredFormat.numberFormat'</span>)<br></code></pre></div></div></li>
    <li><a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request#UpdateCellsRequest">UpdateCellsRequest</a> — применить заданные для каждой ячейки изменения в указанном диапазоне.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Пример</b><div class="spoiler_text"><pre><code class="python"><br><span class="ͼ8"># Задать цвет фона ячеек следующим образом: B4 - красный, C4 - зелёный, B5 - синий, C5 - жёлтый</span><br>{<span class="ͼ7">'updateCells'</span>: {<span class="ͼ7">'range'</span>: {<span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                           <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ9">3</span>,<br>                           <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ9">5</span>,<br>                           <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ9">1</span>,<br>                           <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ9">3</span>},<br>                 <span class="ͼ7">'rows'</span>: [{<span class="ͼ7">'values'</span>: [{<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}}},<br>                                      {<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}}}]},<br>                          {<span class="ͼ7">'values'</span>: [{<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">1</span>}}},<br>                                      {<span class="ͼ7">'userEnteredFormat'</span>: {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}}}]}],<br>                 <span class="ͼ7">'fields'</span>: <span class="ͼ7">'userEnteredFormat'</span>}}<br><br><span class="ͼ8"># Подготовить такой запрос при помощи класса Spreadsheet</span><br><span class="ͼ5">ss</span>.<span class="ͼ6">prepare_setCellsFormats</span>(<span class="ͼ7">'B4:C5'</span>, [[{<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}},<br>                                      {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}}],<br>                                     [{<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">1</span>}},<br>                                      {<span class="ͼ7">'backgroundColor'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">1</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>}}]])<br></code></pre></div></div></li>
    <li><a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/request#UpdateBordersRequest">UpdateBordersRequest</a> — задать границу ячеек.<br>
    <br>
    <div class="spoiler"><b class="spoiler_title">Пример</b><div class="spoiler_text"><pre><code class="python"><br><span class="ͼ8"># Чёрная сплошная граница толщиной 1 под A3:E3</span><br>{<span class="ͼ7">'updateBorders'</span>: {<span class="ͼ7">'range'</span>: {<span class="ͼ7">'sheetId'</span>: <span class="ͼ9">0</span>,<br>                             <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ9">2</span>,<br>                             <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ9">3</span>,<br>                             <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ9">0</span>,<br>                             <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ9">5</span>},<br>                   <span class="ͼ7">'bottom'</span>: {<span class="ͼ7">'style'</span>: <span class="ͼ7">'SOLID'</span>,<br>                              <span class="ͼ7">'width'</span>: <span class="ͼ9">1</span>,<br>                              <span class="ͼ7">'color'</span>: {<span class="ͼ7">'red'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'green'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'blue'</span>: <span class="ͼ9">0</span>, <span class="ͼ7">'alpha'</span>: <span class="ͼ9">1</span>}}}}<br></code></pre></div></div></li>
    </ul><br>
    <h3><font color="#ff6000">Некоторые тонкости</font></h3><br>
    <b>Q1:</b> Зачем всё же при создании документа (в 3.3) параметру <code>locale</code> было задано значение <code>ru_RU</code>?<br>
    <b>A1:</b> Дело в том, что в этом случае строка, имеющая вид<code> 2 <u>июл</u> 2016 17:57:52</code>, будет распознаваться таблицей как дата и время. Соответственно, такие ячейки можно использовать в формуле для вычисления продолжительности (как разности двух дат, например).<br>
    <br>
    <b>Q2:</b> Откуда получено, что формат «продолжительность» это<code> {'numberFormat': {'pattern': '[h]:mm:ss', 'type': 'TIME'}}</code>?<br>
    <br>
    <img src="https://habrastorage.org/r/w1560/files/808/68e/447/80868e447dec4b75991f323d254f58ed.png" data-src="https://habrastorage.org/files/808/68e/447/80868e447dec4b75991f323d254f58ed.png"><br>
    <br>
    <b>A2:</b> До этого можно докопаться, изучая документацию. Но я просто вручную задал конкретной ячейке формат отображения «продолжительность», а затем получил документ программой с помощью функции <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets/get"><b>spreadsheets.get</b></a>, задав параметру <code>includeGridData</code> значение <code>True</code>, и посмотрел, какое значение параметра <code>numberFormat</code> у той ячейки.<br>
    <br>
    <b>Q3:</b> В запросах, передаваемых функции <b>spreadsheets.batchUpdate</b>, параметр <code>range</code> имеет формат <a href="https://developers.google.com/sheets/reference/rest/v4/spreadsheets#GridRange">GridRange</a>:<br>
    <br>
    <pre><code class="python">{<br>  <span class="ͼ7">'sheetId'</span>: <span class="ͼ5">число</span>,<br>  <span class="ͼ7">'startRowIndex'</span>: <span class="ͼ5">число</span>,<br>  <span class="ͼ7">'endRowIndex'</span>: <span class="ͼ5">число</span>,<br>  <span class="ͼ7">'startColumnIndex'</span>: <span class="ͼ5">число</span>,<br>  <span class="ͼ7">'endColumnIndex'</span>: <span class="ͼ5">число</span><br>}<br></code></pre><br>
    А в прямоугольниках с данными для функции <b>spreadsheets.values.batchUpdate</b> параметр <code>range</code> — это строка, вида <code>Название_листа!A5:E7</code> (<a href="https://developers.google.com/sheets/guides/concepts#a1_notation">A1 notation</a>). Странно.<br>
    <b>A3:</b> Да. Возможно, в комментариях к статье кто-нибудь объяснит, почему так.<br>
    В классе-обёртке я сделал для удобства метод <a href="https://github.com/Tsar/Spreadsheet/blob/master/Spreadsheet.py#L131">toGridRange</a>.<br>
    <br>
    <b>Q4:</b> Пикачу, который в <a href="https://docs.google.com/spreadsheets/d/1kygOW5wSSVqwf26M-OCT72i0FX0olZAz4duT2i6psp4/edit?usp=sharing">таблице в начале статьи</a>, посажен туда программно?<br>
    <b>A4:</b> Нет, Пикачу я разместил в таблице вручную. Не уверен, что Google Sheets API v4 позволяет сделать это программно, сходу нужную функцию не нашёл.<br>
    <br>
    <b>Q5:</b> Есть ли какие-то ограничения использования Google Sheets API v4?<br>
    <b>A5:</b> Да, они называются квотами. За ними можно <a href="https://console.developers.google.com/iam-admin/quotas">следить в Google Developers Console</a>. Там же можно отправить запрос на увеличение квоты, если будет не хватать.<br>
    <img src="https://habrastorage.org/r/w1560/files/c7b/9a1/0bf/c7b9a10bf43744f5bd9a52b8043e05f2.png" data-src="https://habrastorage.org/files/c7b/9a1/0bf/c7b9a10bf43744f5bd9a52b8043e05f2.png"><br>
    <br>
    <h2>Заключение</h2><br>
    Если Вы дочитали досюда, то, вероятно, освоили, как программно создать spreadsheet, и теперь горите желанием использовать Google-таблицы во всех своих проектах :)<br>
    <br>
    Приведу повторно самые важные ссылки:<br>
    <ul>
    <li><a href="https://developers.google.com/sheets/">Google Sheets API v4</a></li>
    <li><a href="https://console.developers.google.com/">Google Developers Console</a></li>
    <li><a href="https://github.com/Tsar/Spreadsheet/blob/master/Spreadsheet.py">Класс-обёртка Spreadsheet и примеры его использования</a></li>
    </ul></div></div>
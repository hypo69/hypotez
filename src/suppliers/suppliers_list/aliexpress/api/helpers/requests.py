## \file /src/suppliers/aliexpress/api/helpers/requests.py
# -*- coding: utf-8 -*-
 # <- venv win
## ~~~~~~~~~~~~~
""" module: src.suppliers.suppliers_list.aliexpress.api.helpers """
from types import SimpleNamespace
from time import sleep
from src.logger.logger import logger
from src.utils.printer import pprint
import json

from ..errors import ApiRequestException, ApiRequestResponseException


def api_request(request, response_name, attemps:int = 1):
    try:
        response = request.getResponse()
    except Exception as error:           
        if hasattr(error, 'message'):
            #raise ApiRequestException(error.message) from error
            #logger.critical(error.message,pprint(error))
        #raise ApiRequestException(error) from error
        #logger.critical(error.message,pprint(error))
            ...    
            return 

    try:
        response = response[response_name]['resp_result']
        response = json.dumps(response)
        response = json.loads(response, object_hook=lambda d: SimpleNamespace(**d))
    except Exception as error:
        #raise ApiRequestResponseException(error) from error
        logger.critical(error.message, pprint(error), exc_info=False)
        return 
    try:
        if response.resp_code == 200:
            return response.result
        else:
            #raise ApiRequestResponseException(f'Response code {response.resp_code} - {response.resp_msg}')
            logger.warning(f'Response code {response.resp_code} - {response.resp_msg}',exc_info=False)
            return 
    except Exception as ex:
        logger.error(None, ex, exc_info=False)
        return 

